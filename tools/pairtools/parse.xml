<tool id="pairtools_parse" name="Pairtools parse" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="22.05">
    <description>Find ligation pairs in .sam data, make .pairs.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        pairtools parse
            '$SAM_PATH'
            -c '$chroms_path'
            -o '$output_parsed_pairs'
            --min-mapq '$minimal_MAPQ'
            --output-stats '$output_stats'
            --walks-policy '$walks_policy'
            --max-inter-align-gap '$max_int_algn_gap'
            --nproc-in \${GALAXY_SLOTS:-4}
            --nproc-out \${GALAXY_SLOTS:-4}
    ]]></command>
    <inputs>
        <param name="SAM_PATH" type="data" format="sam,bam" label="Input SAM/BAM file" help="Input .sam or .bam file with paired-end sequence alignments of Hi-C molecules."/>    
        <param name="chroms_path" type="data" format="tabular" label="Input a chromosome order file" help="Chromosome order used to flip interchromosomal mates. Any scaffolds not listed will be ordered lexicographically."/>
        <param name="minimal_mapq" type="integer" value="40" min="0" label="Minimal MAPQ" help="Minimal MAPQ score to consider a read as uniquely mapped."/>
        <param name="output_stats" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Output parse stats" help="output file for various statistics of pairs file"/>    
        <param name="walks_policy" type="select" label="Walks Policy" help="The policy for reporting unrescuable walks.">
            <expand macro="walks_policy_options"/>
        </param>   
        <param name="max_int_algn_gap" type="integer" value="30" min="0" label="Max alignment gap" help="read segments that are not covered by any alignment and longer than the specified value are treated as null alignments."/>
    </inputs>
    <outputs>
        <data name="output_parsed_pairs" format="tabular" label="${tool.name} on ${on_string}: .pairs"/>
        <data name="output_stats" format="txt, tabular" label="${tool.name} on ${on_string}: parsed.stats" optional="true"/>
    </outputs>
    <tests>
        <!-- Test: default values -->
        <test>
            <param name="SAM_PATH" value="test.sam"/>
            <param name="chroms_path" value="test.genome"/>
            <param name="minimal_MAPQ" value="40"/>
            <param name="walks_policy" value="5unique"/>
            <param name="max_int_algn_gap" value="30"/>
            <output name="output_parsed_pairs"/>
                <assert_contents>
                    <has_n_lines n="600" delta="0"/>
                </assert_contents>
            <output name="output_stats"/>
                <assert_contents>
                    <has_n_lines n="185" delta="10"/>
                </assert_contents>
        </test>
    </tests>
    <help><![CDATA[
        **Pairtools parse**

        Detects ligation events in the aligned sequences of DNA molecules formed in Hi-C experiments and reports them in the .pairs/.pairsam format.
        
    ]]></help>
    <expand macro="citations"/>
    <expand macro="creator"/>
</tool>
